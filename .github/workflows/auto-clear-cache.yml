name: Auto Clear Cache on Push

on:
  push:
    branches: [ main ]

jobs:
  clear-cache:
    runs-on: ubuntu-latest
    
    steps:
    - name: Limpar cache via API
      run: |
        # Faz requisiÃ§Ã£o para limpar o cache do site em produÃ§Ã£o
        if [ "${{ secrets.PRODUCTION_SITE_URL }}" != "" ]; then
          echo "ðŸ”„ Limpando cache do site em produÃ§Ã£o..."
          response=$(curl -s -X POST "${{ secrets.PRODUCTION_SITE_URL }}/api/clear-cache" \
            -H "Content-Type: application/json" \
            -d '{"all": true}')
          
          echo "Resposta: $response"
          
          # Verifica se a limpeza foi bem-sucedida
          if echo "$response" | grep -q '"success":true'; then
            echo "âœ… Cache limpo com sucesso!"
          else
            echo "âŒ Falha ao limpar cache"
            exit 1
          fi
        else
          echo "âš ï¸ PRODUCTION_SITE_URL nÃ£o configurado nos secrets"
          echo "Configure em: Settings > Secrets and variables > Actions"
        fi